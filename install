#!/bin/bash -xe

__deploy=( bash editrc git inputrc python ruby tmux vim conda )

if [ -e ~/.not_a_server ]; then
  __deploy+=( ag i3 tridactyl kitty Xresources )
  __dot_config_deploy=( rofi clipster )
else
  echo "Only installing for a server; otherwise, please touch .not_a_server in your home directory."
fi

mkdir -p ~/.vim
cd ~/.vim
[ -d ftdetect ] || ln -s ~/dotfiles/ftdetect ftdetect
[ -d ftplugin ] || ln -s ~/dotfiles/ftplugin ftplugin
[ -d syntax   ] || ln -s ~/dotfiles/syntax syntax

if command -v nvim &>/dev/null; then
  mkdir -p ~/.config/nvim
  cd ~/.config/nvim
  [ -d ftdetect ] || ln -s ~/dotfiles/ftdetect ftdetect
  [ -d ftplugin ] || ln -s ~/dotfiles/ftplugin ftplugin
  [ -d syntax   ] || ln -s ~/dotfiles/syntax syntax
  [ -e init.vim ] || ln -s ~/dotfiles/nvim/nvimrc init.vim
fi

cd ~
[ -L ~/bin ] && rm ~/bin
ln -s ~/dotfiles/bin bin

for dir in "${__deploy[@]}"; do
  for path in ~/dotfiles/"${dir}"/*; do
    file_name=`basename "${path}"`
    [ -L ."${file_name}" ] && rm ."${file_name}"
    ln -s "${path}" ."${file_name}"
  done
done

cd ~/.config

for dir in "${__dot_config_deploy[@]}"; do
  for path in ~/dotfiles/"${dir}"/*; do
    file_name=${dir}/`basename "${path}"`
    mkdir -p "${dir}"
    [ -L "${file_name}" ] && rm "${file_name}"
    ln -s "${path}" "${file_name}"
  done
done

# sudo usermod -a -G video username
# Didn't work? Add manually to video in /etc/group-
# TODO: Why the hyphen?

# Chrome:
# wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
# sudo sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google-chrome.list'

# gdrive:
# go get github.com/prasmussen/gdrive
# Credentials problem:
# https://github.com/gdrive-org/gdrive/issues/506
# Points to:
# https://github.com/mbrother2/backuptogoogle/wiki/Create-own-Google-credential-step-by-step
# Which means making a credential for a dummy project here:
# https://console.developers.google.com/apis/credentials
# Then editing the binary:
# sed -i "s|367116221053-7n0vf5akeru7on6o2fjinrecpdoe99eg.apps.googleusercontent.com|INSERT_DOMAIN_HERE|g" path/to/the/executable/gdrive
# sed -i "s|1qsNodXNaWq1mQuBjUjmvhoO|INSERT_TOKEN_HERE|g" path/to/the/executable/gdrive

# Add i3batwarn.sh to crontab every five minutes or so
